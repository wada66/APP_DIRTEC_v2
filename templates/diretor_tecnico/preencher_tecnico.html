{% extends 'base.html' %}

{% block title %}Complementar Processo {{ processo.protocolo }}{% endblock %}

{% block content %}
<style>
    /* Importa o estilo do formulário para este template */
    :root {
        --primary-color: #007bff;
        --secondary-color: #6c757d;
        --success-color: #28a745;
        --danger-color: #dc3545;
        --bg-color: #f4f7f9;
        --card-bg: #ffffff;
        --border-color: #ced4da;
        --shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        --transition: all 0.3s ease;
    }

    .container {
        max-width: 800px;
        width: 100%;
        background: var(--card-bg);
        padding: 30px;
        border-radius: 12px;
        box-shadow: var(--shadow);
        margin: auto;
    }

    h1 {
        color: #333;
        font-weight: 600;
        margin-bottom: 25px;
        text-align: center;
    }

    h2 {
        font-size: 1.2rem;
        color: var(--primary-color);
        margin-top: 30px;
        margin-bottom: 15px;
        border-bottom: 2px solid var(--primary-color);
        padding-bottom: 5px;
    }

    label {
        display: block;
        margin-top: 15px;
        font-weight: 500;
        color: #555;
        transition: var(--transition);
    }

    input[type="text"],
    input[type="date"],
    select,
    textarea {
        width: 100%;
        padding: 12px;
        margin-top: 8px;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        box-sizing: border-box;
        font-family: 'Poppins', sans-serif;
        font-size: 1rem;
        transition: var(--transition);
        resize: vertical;
    }

    input[type="text"]:focus,
    input[type="date"]:focus,
    select:focus,
    textarea:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
    }

    .checkbox-inline {
        display: inline-block;
        margin-right: 25px;
        margin-top: 15px;
    }

    .checkbox-inline label {
        display: inline-block;
        margin-top: 0;
        font-weight: 400;
    }

    .campo-condicional {
        margin-left: 0;
        display: none;
        padding-left: 20px;
        border-left: 2px solid #e0e0e0;
        margin-top: 20px;
    }

    .campo-condicional label {
        margin-top: 0;
    }

    hr {
        border: 0;
        border-top: 1px solid #e0e0e0;
        margin: 30px 0;
    }

    .button-group {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 40px;
    }

    button {
        padding: 12px 25px;
        border: none;
        border-radius: 8px;
        font-family: 'Poppins', sans-serif;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
    }

    button[type="submit"] {
        background-color: var(--primary-color);
        color: white;
    }

    button[type="submit"]:hover {
        background-color: #0056b3;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 123, 255, 0.2);
    }

    button[type="reset"] {
        background-color: var(--secondary-color);
        color: white;
    }

    button[type="reset"]:hover {
        background-color: #5a6268;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(108, 117, 125, 0.2);
    }
</style>

<div class="container">
    <h1>Complementar Processo - Protocolo {{ processo.protocolo }}</h1>
    <form method="POST" action="{{ url_for('diretor_tecnico.preencher_tecnico', protocolo=processo.protocolo) }}">

        <h2>Informações Principais</h2>

        <label>
            Protocolo:
            <input type="text" name="protocolo" value="{{ processo.protocolo }}" readonly>
        </label>

        <label>
            Observações:
            <textarea id="observacoes" name="observacoes" rows="3" {% if processo.observacoes %}readonly{% endif %}>{{ processo.observacoes }}</textarea>
            {% if processo.observacoes %}
            <label><input type="checkbox" class="toggle-edit" data-target="observacoes"> Editar</label>
            {% endif %}
        </label>

        <label>
            Número da Pasta:
            <input type="text" id="numero_pasta" name="numero_pasta" value="{{ processo.numero_pasta or '' }}" {% if processo.numero_pasta %}readonly{% endif %}>
            {% if processo.numero_pasta %}
            <label><input type="checkbox" class="toggle-edit" data-target="numero_pasta"> Editar</label>
            {% endif %}
        </label>

        <label>
            Solicitação do Requerente:
            <select id="solicitacao_resposta" name="solicitacao_resposta" {% if processo.solicitacao_resposta %}disabled{% endif %}>
                <option value="">--Selecione--</option>
                {% for opcao in solicitacao_resposta %}
                <option value="{{ opcao }}" {% if processo.solicitacao_resposta == opcao %}selected{% endif %}>{{ opcao }}</option>
                {% endfor %}
            </select>
            {% if processo.solicitacao_resposta %}
            <label><input type="checkbox" class="toggle-edit" data-target="solicitacao_resposta"> Editar</label>
            {% endif %}
        </label>

        <label>
            Resposta do Departamento:
            <select id="resposta_departamento" name="resposta_departamento" {% if processo.resposta_departamento %}disabled{% endif %}>
                <option value="">--Selecione--</option>
                {% for opcao in solicitacao_resposta %}
                <option value="{{ opcao }}" {% if processo.resposta_departamento == opcao %}selected{% endif %}>{{ opcao }}</option>
                {% endfor %}
            </select>
            {% if processo.resposta_departamento %}
            <label><input type="checkbox" class="toggle-edit" data-target="resposta_departamento"> Editar</label>
            {% endif %}
        </label>

        <label>
            Tramitação:
            <select id="tramitacao" name="tramitacao" {% if processo.tramitacao %}disabled{% endif %}>
                <option value="">--Selecione--</option>
                {% for opcao in tramitacao %}
                <option value="{{ opcao }}" {% if processo.tramitacao == opcao %}selected{% endif %}>{{ opcao }}</option>
                {% endfor %}
            </select>
            {% if processo.tramitacao %}
            <label><input type="checkbox" class="toggle-edit" data-target="tramitacao"> Editar</label>
            {% endif %}
        </label>

        <label>
            Tipologia:
            <select id="tipologia" name="tipologia" {% if processo.tipologia %}disabled{% endif %}>
                <option value="">--Selecione--</option>
                {% for opcao in tipologia %}
                <option value="{{ opcao }}" {% if processo.tipologia == opcao %}selected{% endif %}>{{ opcao }}</option>
                {% endfor %}
            </select>
            {% if processo.tipologia %}
            <label><input type="checkbox" class="toggle-edit" data-target="tipologia"> Editar</label>
            {% endif %}
        </label>

        <label>
            Município:
            <select id="municipio" name="municipio" {% if processo.municipio %}disabled{% endif %}>
                <option value="">--Selecione--</option>
                {% for opcao in municipio %}
                <option value="{{ opcao }}" {% if processo.municipio == opcao %}selected{% endif %}>{{ opcao }}</option>
                {% endfor %}
            </select>
            {% if processo.municipio %}
            <label><input type="checkbox" class="toggle-edit" data-target="municipio"> Editar</label>
            {% endif %}
        </label>

        <!-- Mantém as divs condicionais com visibilidade controlada por style -->

        <div class="campo-condicional" id="zona-urbana-container" style="{{ 'display:block;' if processo.zona_urbana else 'display:none;' }}">
            <label>
                Zona Urbana:
                <select id="zona-urbana" name="zona_urbana" {% if processo.zona_urbana %}disabled{% endif %}>
                    <option value="">--Selecione--</option>
                    {% if processo.zona_urbana %}
                    <option value="{{ processo.zona_urbana }}" selected>{{ processo.zona_urbana }}</option>
                    {% endif %}
                </select>
                {% if processo.zona_urbana %}
                <label><input type="checkbox" class="toggle-edit" data-target="zona-urbana"> Editar</label>
                {% endif %}
            </label>
        </div>

        <div class="campo-condicional" id="macrozona-container" style="{{ 'display:block;' if processo.macrozona_municipal else 'display:none;' }}">
            <label>
                Macrozona Municipal:
                <select id="macrozona_municipal" name="macrozona_municipal" {% if processo.macrozona_municipal %}disabled{% endif %}>
                    <option value="">--Selecione--</option>
                    {% if processo.macrozona_municipal %}
                    <option value="{{ processo.macrozona_municipal }}" selected>{{ processo.macrozona_municipal }}</option>
                    {% endif %}
                </select>
                {% if processo.macrozona_municipal %}
                <label><input type="checkbox" class="toggle-edit" data-target="macrozona_municipal"> Editar</label>
                {% endif %}
            </label>
        </div>

        <label>
            Situação da Localização:
            <select id="situacao_localizacao" name="situacao_localizacao" {% if processo.situacao_localizacao %}disabled{% endif %}>
                <option value="">--Selecione--</option>
                {% for opcao in situacoes_localizacao %}
                <option value="{{ opcao }}" {% if processo.situacao_localizacao == opcao %}selected{% endif %}>{{ opcao }}</option>
                {% endfor %}
            </select>
            {% if processo.situacao_localizacao %}
            <label><input type="checkbox" class="toggle-edit" data-target="situacao_localizacao"> Editar</label>
            {% endif %}
        </label>

        <div class="campo-condicional" id="localizacao-detalhes" style="{{ 'display:block;' if processo.situacao_localizacao == 'LOCALIZADA' else 'display:none;' }}">
            <label>
                Responsável pela Localização:
                <select name="responsavel_localizacao_cpf" {% if processo.responsavel_localizacao_cpf %}disabled{% endif %}>
                    <option value="">--Selecione--</option>
                    {% for cpf, nome, setor in tecnico %}
                    <option value="{{ cpf }}" {% if processo.responsavel_localizacao_cpf == cpf %}selected{% endif %}>{{ nome }}</option>
                    {% endfor %}
                </select>
                {% if processo.responsavel_localizacao_cpf %}
                <label><input type="checkbox" class="toggle-edit" data-target="responsavel_localizacao_cpf"> Editar</label>
                {% endif %}
            </label>

            <label>
                Início da Localização:
                <input type="date" name="inicio_localizacao" value="{{ processo.inicio_localizacao or '' }}" {% if processo.inicio_localizacao %}readonly{% endif %}>
                {% if processo.inicio_localizacao %}
                <label><input type="checkbox" class="toggle-edit" data-target="inicio_localizacao"> Editar</label>
                {% endif %}
            </label>

            <label>
                Fim da Localização:
                <input type="date" name="fim_localizacao" value="{{ processo.fim_localizacao or '' }}" {% if processo.fim_localizacao %}readonly{% endif %}>
                {% if processo.fim_localizacao %}
                <label><input type="checkbox" class="toggle-edit" data-target="fim_localizacao"> Editar</label>
                {% endif %}
            </label>
        </div>

        <hr />

        <h2>Detalhes do Projeto</h2>

        <label>
            Nome ou loteamento do condomínio a ser aprovado:
            <input type="text" name="nome_ou_loteamento_do_condominio_a_ser_aprovado" value="{{ processo.nome_ou_loteamento_do_condominio_a_ser_aprovado or '' }}" {% if processo.nome_ou_loteamento_do_condominio_a_ser_aprovado %}readonly{% endif %}>
            {% if processo.nome_ou_loteamento_do_condominio_a_ser_aprovado %}
            <label><input type="checkbox" class="toggle-edit" data-target="nome_ou_loteamento_do_condominio_a_ser_aprovado"> Editar</label>
            {% endif %}
        </label>

        <label>
            Interesse Social:
            <input type="checkbox" name="interesse_social" id="interesse_social" {% if processo.interesse_social %}checked{% endif %} disabled>
            {% if processo.interesse_social %}
            <label><input type="checkbox" class="toggle-edit" data-target="interesse_social_checkbox"> Editar</label>
            {% endif %}
        </label>
        <input type="hidden" name="interesse_social" value="{{ processo.interesse_social | default(false) }}">

        <label>
            Lei inclui perímetro urbano:
            <input type="checkbox" name="lei_inclui_perimetro_urbano" id="lei_inclui_perimetro_urbano" {% if processo.lei_inclui_perimetro_urbano %}checked{% endif %} disabled>
            {% if processo.lei_inclui_perimetro_urbano %}
            <label><input type="checkbox" class="toggle-edit" data-target="lei_inclui_perimetro_urbano_checkbox"> Editar</label>
            {% endif %}
        </label>
        <input type="hidden" name="lei_inclui_perimetro_urbano" value="{{ processo.lei_inclui_perimetro_urbano | default(false) }}">

        <hr />

        <h2>Informações do Requerente</h2>

        <label>
            Nome do Requerente:
            <input type="text" name="nome_requerente" value="{{ processo.nome_requerente or '' }}" {% if processo.nome_requerente %}readonly{% endif %}>
            {% if processo.nome_requerente %}
            <label><input type="checkbox" class="toggle-edit" data-target="nome_requerente"> Editar</label>
            {% endif %}
        </label>

        <label>
            Tipo de Requerente:
            <select id="tipo_de_requerente" name="tipo_de_requerente" {% if processo.tipo_de_requerente %}disabled{% endif %}>
                <option value="">--Selecione--</option>
                <option value="PESSOA FÍSICA" {% if processo.tipo_de_requerente == 'PESSOA FÍSICA' %}selected{% endif %}>Pessoa Física</option>
                <option value="PESSOA JURÍDICA" {% if processo.tipo_de_requerente == 'PESSOA JURÍDICA' %}selected{% endif %}>Pessoa Jurídica</option>
            </select>
            {% if processo.tipo_de_requerente %}
            <label><input type="checkbox" class="toggle-edit" data-target="tipo_de_requerente"> Editar</label>
            {% endif %}
        </label>

        <div class="campo-condicional" id="cpf-container" style="{{ 'display:block;' if processo.tipo_de_requerente == 'PESSOA FÍSICA' else 'display:none;' }}">
            <label>
                CPF:
                <input type="text" name="cpf_requerente" id="cpf_requerente" maxlength="14" placeholder="Digite o CPF" value="{{ processo.cpf_requerente or '' }}" {% if processo.cpf_requerente %}readonly{% endif %}>
                {% if processo.cpf_requerente %}
                <label><input type="checkbox" class="toggle-edit" data-target="cpf_requerente"> Editar</label>
                {% endif %}
            </label>
        </div>

        <div class="campo-condicional" id="cnpj-container" style="{{ 'display:block;' if processo.tipo_de_requerente == 'PESSOA JURÍDICA' else 'display:none;' }}">
            <label>
                CNPJ:
                <input type="text" name="cnpj_requerente" id="cnpj_requerente" maxlength="18" placeholder="Digite o CNPJ" value="{{ processo.cnpj_requerente or '' }}" {% if processo.cnpj_requerente %}readonly{% endif %}>
                {% if processo.cnpj_requerente %}
                <label><input type="checkbox" class="toggle-edit" data-target="cnpj_requerente"> Editar</label>
                {% endif %}
            </label>
        </div>

        <label>
            Nome do Proprietário:
            <input type="text" name="nome_proprietario" value="{{ processo.nome_proprietario or '' }}" {% if processo.nome_proprietario %}readonly{% endif %}>
            {% if processo.nome_proprietario %}
            <label><input type="checkbox" class="toggle-edit" data-target="nome_proprietario"> Editar</label>
            {% endif %}
        </label>

        <label>
            CPF/CNPJ do Proprietário:
            <input type="text" name="cpf_cnpj_proprietario" maxlength="18" value="{{ processo.cpf_cnpj_proprietario or '' }}" {% if processo.cpf_cnpj_proprietario %}readonly{% endif %}>
            {% if processo.cpf_cnpj_proprietario %}
            <label><input type="checkbox" class="toggle-edit" data-target="cpf_cnpj_proprietario"> Editar</label>
            {% endif %}
        </label>

        <label>
            Matrícula do Imóvel:
            <input type="text" name="matricula_imovel" value="{{ processo.matricula_imovel or '' }}" {% if processo.matricula_imovel %}readonly{% endif %}>
            {% if processo.matricula_imovel %}
            <label><input type="checkbox" class="toggle-edit" data-target="matricula_imovel"> Editar</label>
            {% endif %}
        </label>

        <label>
            Prioridade:
            <select name="prioridade" id="prioridade" {% if processo.prioridade %}disabled{% endif %}>
                <option value="">--Selecione--</option>
                {% for opcao in prioridade %}
                <option value="{{ opcao }}" {% if processo.prioridade == opcao %}selected{% endif %}>{{ opcao }}</option>
                {% endfor %}
            </select>
            {% if processo.prioridade %}
            <label><input type="checkbox" class="toggle-edit" data-target="prioridade"> Editar</label>
            {% endif %}
        </label>

        <label>
            Complexidade:
            <select name="complexidade" id="complexidade" {% if processo.complexidade %}disabled{% endif %}>
                <option value="">--Selecione--</option>
                {% for opcao in complexidade %}
                <option value="{{ opcao }}" {% if processo.complexidade == opcao %}selected{% endif %}>{{ opcao }}</option>
                {% endfor %}
            </select>
            {% if processo.complexidade %}
            <label><input type="checkbox" class="toggle-edit" data-target="complexidade"> Editar</label>
            {% endif %}
        </label>

        <hr />

        <h2>Áreas Condicionais</h2>

        <div>
            <label>
                Possui APA?
                <input type="checkbox" id="possui-apa" class="trigger-condicional toggle-edit" data-target="apa-container" {% if processo.possui_apa %}checked{% endif %} disabled>
                {% if processo.possui_apa %}
                <label><input type="checkbox" class="toggle-edit" data-target="possui-apa"> Editar</label>
                {% endif %}
            </label>
        </div>

        <div class="campo-condicional" id="apa-container" style="{{ 'display:block;' if processo.possui_apa else 'display:none;' }}">
            <label>
                Selecione a APA:
                <select name="apa" id="apa" {% if processo.apa %}disabled{% endif %}>
                    <option value="">--Selecione--</option>
                    {% for opcao in enums.apa %}
                    <option value="{{ opcao }}" {% if processo.apa == opcao %}selected{% endif %}>{{ opcao }}</option>
                    {% endfor %}
                </select>
                {% if processo.apa %}
                <label><input type="checkbox" class="toggle-edit" data-target="apa"> Editar</label>
                {% endif %}
            </label>
        </div>

        <div class="campo-condicional" id="zona-apa-container" style="{{ 'display:block;' if processo.zona_apa else 'display:none;' }}">
            <label>
                Zona da APA:
                <select id="zona-apa" name="zona_apa" {% if processo.zona_apa %}disabled{% endif %}>
                    <option value="">--Selecione--</option>
                    {% if processo.zona_apa %}
                    <option value="{{ processo.zona_apa }}" selected>{{ processo.zona_apa }}</option>
                    {% endif %}
                </select>
                {% if processo.zona_apa %}
                <label><input type="checkbox" class="toggle-edit" data-target="zona-apa"> Editar</label>
                {% endif %}
            </label>
        </div>

        <div>
            <label>
                Possui UTP?
                <input type="checkbox" id="possui-utp" class="trigger-condicional toggle-edit" data-target="utp-container" {% if processo.possui_utp %}checked{% endif %} disabled>
                {% if processo.possui_utp %}
                <label><input type="checkbox" class="toggle-edit" data-target="possui-utp"> Editar</label>
                {% endif %}
            </label>
        </div>

        <div class="campo-condicional" id="utp-container" style="{{ 'display:block;' if processo.possui_utp else 'display:none;' }}">
            <label>
                Selecione a UTP:
                <select name="utp" id="utp" {% if processo.utp %}disabled{% endif %}>
                    <option value="">--Selecione--</option>
                    {% for opcao in enums.utp %}
                    <option value="{{ opcao }}" {% if processo.utp == opcao %}selected{% endif %}>{{ opcao }}</option>
                    {% endfor %}
                </select>
                {% if processo.utp %}
                <label><input type="checkbox" class="toggle-edit" data-target="utp"> Editar</label>
                {% endif %}
            </label>
        </div>

        <div class="campo-condicional" id="zona-utp-container" style="{{ 'display:block;' if processo.zona_utp else 'display:none;' }}">
            <label>
                Zona da UTP:
                <select id="zona-utp" name="zona_utp" {% if processo.zona_utp %}disabled{% endif %}>
                    <option value="">--Selecione--</option>
                    {% if processo.zona_utp %}
                    <option value="{{ processo.zona_utp }}" selected>{{ processo.zona_utp }}</option>
                    {% endif %}
                </select>
                {% if processo.zona_utp %}
                <label><input type="checkbox" class="toggle-edit" data-target="zona-utp"> Editar</label>
                {% endif %}
            </label>
        </div>

        <div>
            <label>
                Possui Manancial?
                <input type="checkbox" id="possui-manancial" class="trigger-condicional toggle-edit" data-target="tipo-manancial-container" {% if processo.possui_manancial %}checked{% endif %} disabled>
                {% if processo.possui_manancial %}
                <label><input type="checkbox" class="toggle-edit" data-target="possui-manancial"> Editar</label>
                {% endif %}
            </label>
        </div>

        <div class="campo-condicional" id="tipo-manancial-container" style="{{ 'display:block;' if processo.possui_manancial else 'display:none;' }}">
            <label>
                Tipo de Manancial:
                <select name="tipo_manancial" id="tipo-manancial" {% if processo.tipo_manancial %}disabled{% endif %}>
                    <option value="">--Selecione--</option>
                    {% for opcao in enums.manancial %}
                    <option value="{{ opcao }}" {% if processo.tipo_manancial == opcao %}selected{% endif %}>{{ opcao }}</option>
                    {% endfor %}
                </select>
                {% if processo.tipo_manancial %}
                <label><input type="checkbox" class="toggle-edit" data-target="tipo-manancial"> Editar</label>
                {% endif %}
            </label>
        </div>

        <div>
            <label>
                Possui Curva de Inundação?
                <input type="checkbox" id="possui-curva" class="trigger-condicional toggle-edit" data-target="curva-inundacao-container" {% if processo.possui_curva %}checked{% endif %} disabled>
                {% if processo.possui_curva %}
                <label><input type="checkbox" class="toggle-edit" data-target="possui-curva"> Editar</label>
                {% endif %}
            </label>
        </div>

        <div class="campo-condicional" id="curva-inundacao-container" style="{{ 'display:block;' if processo.possui_curva else 'display:none;' }}">
            <label>
                Curva de Inundação:
                <select name="curva_inundacao" id="curva_inundacao" {% if processo.curva_inundacao %}disabled{% endif %}>
                    <option value="">--Selecione--</option>
                    {% for opcao in curva_inundacao %}
                    <option value="{{ opcao }}" {% if processo.curva_inundacao == opcao %}selected{% endif %}>{{ opcao }}</option>
                    {% endfor %}
                </select>
                {% if processo.curva_inundacao %}
                <label><input type="checkbox" class="toggle-edit" data-target="curva_inundacao"> Editar</label>
                {% endif %}
            </label>
        </div>

        <div>
            <label>
                Possui Faixa de Servidão?
                <input type="checkbox" id="possui-faixa" class="trigger-condicional toggle-edit" data-target="faixa-servidao-container" {% if processo.possui_faixa %}checked{% endif %} disabled>
                {% if processo.possui_faixa %}
                <label><input type="checkbox" class="toggle-edit" data-target="possui-faixa"> Editar</label>
                {% endif %}
            </label>
        </div>

        <div class="campo-condicional" id="faixa-servidao-container" style="{{ 'display:block;' if processo.possui_faixa else 'display:none;' }}">
            <label>
                Faixa de Servidão:
                <select name="faixa_servidao" id="faixa_servidao" {% if processo.faixa_servidao %}disabled{% endif %}>
                    <option value="">--Selecione--</option>
                    {% for opcao in faixa_servidao %}
                    <option value="{{ opcao }}" {% if processo.faixa_servidao == opcao %}selected{% endif %}>{{ opcao }}</option>
                    {% endfor %}
                </select>
                {% if processo.faixa_servidao %}
                <label><input type="checkbox" class="toggle-edit" data-target="faixa_servidao"> Editar</label>
                {% endif %}
            </label>
        </div>

        <div>
            <label>
                Possui Diretriz Viária?
                <input type="checkbox" id="possui-diretriz" class="trigger-condicional toggle-edit" data-target="diretriz-viaria-container" {% if processo.possui_diretriz %}checked{% endif %} disabled>
                {% if processo.possui_diretriz %}
                <label><input type="checkbox" class="toggle-edit" data-target="possui-diretriz"> Editar</label>
                {% endif %}
            </label>
        </div>

        <div class="campo-condicional" id="diretriz-viaria-container" style="{{ 'display:block;' if processo.possui_diretriz else 'display:none;' }}">
            <label>
                Classificação Diretriz Viária:
                <select name="sistema_viario" id="sistema_viario" {% if processo.sistema_viario %}disabled{% endif %}>
                    <option value="">--Selecione--</option>
                    {% for opcao in sistema_viario %}
                    <option value="{{ opcao }}" {% if processo.sistema_viario == opcao %}selected{% endif %}>{{ opcao }}</option>
                    {% endfor %}
                </select>
                {% if processo.sistema_viario %}
                <label><input type="checkbox" class="toggle-edit" data-target="sistema_viario"> Editar</label>
                {% endif %}
            </label>
        </div>

        <div class="button-group">
            <button type="submit" name="salvar" value="1">Salvar</button>
            <button type="submit" name="finalizar" value="1">Finalizar</button>
            <button type="reset">Limpar</button>
        </div>

    </form>
</div>

<script>
document.querySelectorAll('.toggle-edit').forEach(function(checkbox) {
    checkbox.addEventListener('change', function() {
        const targetId = this.getAttribute('data-target');
        let target = document.getElementById(targetId);
        if (!target) {
            // fallback para procurar por name (para checkboxes escondidos)
            target = document.getElementsByName(targetId)[0];
        }
        if (!target) return;

        if(this.checked) {
            target.removeAttribute('readonly');
            target.removeAttribute('disabled');
            target.focus();
        } else {
            if(target.tagName === "SELECT" || target.type === "checkbox") {
                target.setAttribute('disabled', 'disabled');
            } else {
                target.setAttribute('readonly', 'readonly');
            }
        }
    });
});
</script>
{% endblock %}
